/*Хранимая процедура.

У вас в неком южноамериканском порту K лежит некий груз кофе -- X тонн.
У вас есть два покупателя A и B. 
Покупатель A согласен приехать за кофе в европейский порт L,
а покупатель B согласен приехать в порт M. 
Посчитайте, кому из них выгоднее везти ваш кофе и на каком корабле.*/

alter procedure ChooseCustomer(
  @portK char(30)
, @amountX int
, @customerA char(30)
, @customerB char(30)
, @portL char(30)
, @portM char(30)
, @choosenCustomer char(30) output
, @choosenShip char(30) output
)

as begin

declare SuitableShip
cursor for 
select name, cost, portE
from Ship
where portA=@portK
and capacity>=@amountX
and (portE=@portL
or portE=@portM)

declare @ship char(30)
, @cost int
, @portE char(30)
, @min int

open SuitableShip

fetch SuitableShip into @ship, @cost, @portE

set @min=@cost
set @choosenShip=@ship
if (@portE=@portL) set @choosenCustomer=@customerA
else set @choosenCustomer=@customerB

while (@@FETCH_STATUS=0)
begin

if(@min>@cost) 
begin
set @min=@cost
set @choosenShip=@ship
if(@portE=@portL) set @choosenCustomer=@customerA
else set @choosenCustomer=@customerB
end

fetch SuitableShip into @ship, @cost, @portE

end;

close SuitableShip
deallocate SuitableShip

end